name: Doppler Secrets Demo

on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  demo-secrets:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v3
      
      - name: Display Secret Names (Secure)
        run: |
          echo "=== Doppler Secrets Available in GitHub Actions ==="
          echo "This workflow has access to the following secrets:"
          echo ""
          echo "✓ API_KEY (synced from Doppler)"
          echo "API_KEY (base64 encoded): $ENCODED_SECRET"
          echo ""
          echo "API_KEY (decoded): $(echo $ENCODED_SECRET | base64 -d)"
          echo "✓ DATABASE_URL (synced from Doppler)"
          echo "✓ STRIPE_KEY (synced from Doppler)"
          echo ""
          echo "Note: Secret values are hidden by GitHub for security"
          echo "=================================================="
      
      - name: Verify Secret is Available
        run: |
          echo "Checking if API_KEY secret exists..."
          if [ -n "${{ secrets.API_KEY }}" ]; then
            echo "✓ API_KEY is available and has a value"
            echo "  Length: ${#SECRET_VALUE} characters"
          else
            echo "✗ API_KEY is not available"
          fi
        env:
          SECRET_VALUE: ${{ secrets.API_KEY }}
      
      - name: Use Secret in Application (Example)
        run: |
          echo "Simulating application startup with Doppler secrets..."
          echo "Starting app with DATABASE_URL: [HIDDEN]"
          echo "Connecting to API with API_KEY: [HIDDEN]"
          echo ""
          echo "In a real application, these secrets would be:"
          echo "  - Used to connect to databases"
          echo "  - Passed to API clients"
          echo "  - Used for authentication"
          echo ""
          echo "✓ Application started successfully with Doppler secrets!"
        env:
          API_KEY: ${{ secrets.API_KEY }}
          DATABASE_URL: ${{ secrets.DATABASE_URL }}
          STRIPE_KEY: ${{ secrets.STRIPE_KEY }}
      
      - name: Show Partial Secret (Safe Demo)
        run: |
          echo "=== Safe Secret Display (First 4 characters only) ==="
          # This shows just the first 4 characters for demo purposes
          SECRET_PREVIEW="${SECRET_VALUE:0:4}..."
          echo "API_KEY starts with: $SECRET_PREVIEW"
          echo ""
          echo "This proves the secret is accessible without exposing it fully"
        env:
          SECRET_VALUE: ${{ secrets.API_KEY }}
